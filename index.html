<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>JSStats</title>
</head>

<body>
  <script type="text/javascript">
    function ComputeExtremes()
    {
      var max = -Infinity, min = Infinity;
      var n = arguments.length;
      for (var i = 0; i < n; i++)
      {
        if (arguments[i] > max)
        {
          max = arguments[i];
        }
        if (arguments[i] < min)
        {
          min = arguments[i];
        }
      }

      return [min, max];
    }

    function ComputeMean()
    {
      var sum = 0.0, mean = 0.0;
      var n = arguments.length;

      if (n > 0)  // mean only defined if n > 0
      {
        for (var i = 0; i < n; i++)
        {
          sum += arguments[i];
        }
        mean = sum / n;
      }

      return mean;  // returns 0 if n < 1
    }

    // arguments: inArr, mean (yes, in this order)
    // inArr contains the numbers
    // mean is their average
    function ComputeStdev()
    {
      var sum = 0.0, stdev = 0.0;
      var m = arguments.length;  // this includes the mean, which is the last arg
      avg = arguments[m - 1];

      if (m > 2) // stdev only defined if m - 1 (the number of terms) > 1, or m > 2
      {
        for (var i = 0; i < m - 1; i++)
        {
          var term = arguments[i] - avg;
          sum += term * term;
        }
        stdev = Math.sqrt((sum / (m - 2)));
      }

      return stdev;  // returns 0 if m - 1 < 2, or m < 3
    }

    function ComputeMedian()
    {
      var median = 0.0;
      var n = arguments.length;
      if (n > 1)  // median only defined if n > 1
      {
        var dArr = [...arguments];  // use spread operator to make deep copy of arguments array
        // var dArr = arguments.slice();  // this makes a shallow copy of the immutable arguments array
        // first, sort the data points
        dArr.sort((a, b) => a - b);  // arguments array is immutable - cannot be sorted (reordered)

        var m = Math.floor(n / 2);
        if (n % 2 == 0)  // if even number of pts, take average of the middle two
        { 
          return (dArr[m - 1] + dArr[m]) / 2.0;
        }
        else  // if odd number of pts, take the middle one
        {
          return dArr[m];
        }
      }
    
      return median;  // returns 0 if n < 2
    }

    function PrintDataPoints()
    {
      var outStr = "";
      var n = arguments.length;

      if (n > 0)
      {
        if (n < 10)  // print all data points
        {
          for (var i = 0; i < n; i++)
          {
            outStr += "Data point " + (i + 1) + ": " + arguments[i].toFixed(2) + "\n";
          }
        }
        else  // just print first and last five data points
        {
          for (var i = 0; i < 5; i++)
          {
            outStr += "Data point " + (i + 1) + ": " + arguments[i].toFixed(2) + "\n";
          }
          outStr += "    ...\n";
          for (var i = n - 5; i < n; i++)
          {
            outStr += "Data point " + (i + 1) + ": " + arguments[i].toFixed(2) + "\n";
          }
        }
      }

      return outStr;
    }

    function PrintOutStats()
    {
      var outStr = "";
      var n = arguments.length;
      var nArr = [...arguments];

      var minmax = ComputeExtremes(...nArr);
      var mean = ComputeMean(...nArr);
      outStr += "\nFor " + n + " data point(s), \n";
      outStr += "    the maximum is " + minmax[1].toFixed(2) + "\n";
      outStr += "    the minimum is " + minmax[0].toFixed(2) + "\n";
      outStr += "    the mean (average) is " + mean.toFixed(2) + "\n";
      if (n > 1)
      {
        var stdev = ComputeStdev(...nArr, mean);
        outStr += "    the std dev is " + stdev.toFixed(2) + "\n";
        var med = ComputeMedian(...nArr);
        outStr += "    the median is " + med.toFixed(2) + "\n";
      }

      return outStr;
    }

    // for data entered in form as a string of comma-separated values
    function AnalyzeDataPointsFromForm(form)
    {
      var outStr = "";
      var nStr = form.Numbers.value;
      var sArr = nStr.split(',');  // returns 1 even if nStr is empty
      var n = sArr.length;
      if (n == 0 || nStr.length == 0)
      {
        outStr = "No data points to be analyzed.";
        alert(outStr);
        return;
      }

      var nArr = new Array(n);
      for (var i = 0; i < n; i++)
      {
        console.log(sArr[i]);
        nArr[i] = parseFloat(sArr[i].trim());
      }

      outStr += PrintDataPoints(...nArr);
      outStr += PrintOutStats(...nArr);

      alert(outStr);
    }

    // for data contained in a local .txt file whose name is provided
    // data is assumed to be one number per line ('\n'-separated values)
    function AnalyzeDataPointsFromFile(form)
    {
      var outStr = "";
      document.getElementById('file').onchange = function()
      {
        var file = this.files[0];
        // var fName = file.name;
        // alert(fName);  // hides path to fName for security reasons
        var reader = new FileReader();
        reader.onload = function(progressEvent)  // this only executes when a file is loaded
        {
          // entire file is read into a string 'this.result'
          if (this.result.length == 0)
          {
            outStr = "Data file " + file.name + " is empty.";
            alert(outStr);
            return;
          }

          // Entire file - write it out to console for debugging
          // console.log(this.result);  

          // Line by line
          var lines = this.result.split('\n');
          var nArr = [];
          var n = 0;
          for (var line = 0; line < lines.length; line++)
          {
            console.log(lines[line]);
            var lStr = lines[line].trim();
            if (lStr.length > 0)
            {
              nArr[n] = parseFloat(lStr);
              n++;
            }
          }

          outStr += PrintDataPoints(...nArr);
          outStr += PrintOutStats(...nArr);

          alert(outStr);
        };
        reader.readAsText(file);

      };
    }

  </script>
  <noscript>
    Sorry, your browser does not support JavaScript!
  </noscript>

  <form>
    <h2> JavaScript Stats Calculator</h2>
    Enter a comma-separated list of numbers:  
    <input name="Numbers" value="" maxlength="25" size=25>
    <p>
      Click this button to calculate some basic statistics on the numbers  
      <input name="calc" value="Calculate" type=button onClick=AnalyzeDataPointsFromForm(this.form)>
    </p>
  </form>

  <div>
    <label for="File">Or, choose a file with data to analyze</label>
    <input name="File" type="file" id="file" accept=".txt" onclick="AnalyzeDataPointsFromFile();">
  </div>

      


</body>

</html>

